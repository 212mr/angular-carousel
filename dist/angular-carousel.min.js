/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.5 - 2014-10-11
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselAutoSlide",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e=Math.round(1e3*parseFloat(d.rnCarouselAutoSlide)),f=increment=!1,g=c.children().length;b.carouselExposedIndex||(b.carouselExposedIndex=0),stopAutoplay=function(){angular.isDefined(f)&&a.cancel(f),f=void 0},increment=function(){b.carouselExposedIndex=b.carouselExposedIndex<g-1?b.carouselExposedIndex+1:0},restartTimer=function(){stopAutoplay(),f=a(increment,e)},b.$watch("carouselIndex",function(){restartTimer()}),restartTimer(),d.rnCarouselPauseOnHover&&"false"!=d.rnCarouselPauseOnHover&&(c.on("mouseenter",stopAutoplay),c.on("mouseleave",restartTimer)),b.$on("$destroy",function(){stopAutoplay(),c.off("mouseenter",stopAutoplay),c.off("mouseleave",restartTimer)})}}}]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index>0&&a.index--},a.next=function(){a.index<a.items.length-1&&a.index++}},templateUrl:"carousel-controls.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-controls.html",'<div class="rn-carousel-controls">\n  <span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span>\n  <span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span>\n</div>')}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},templateUrl:"carousel-indicators.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-indicators.html",'<div class="rn-carousel-indicator">\n <span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span>\n</div>')}]),function(){"use strict";angular.module("angular-carousel").service("DeviceCapabilities",function(){function a(){var a="transform";return["webkit","moz","o","ms"].every(function(b){var c="-"+b+"-transform";return"undefined"!=typeof document.body.style[c]?(a=c,!1):!0}),a}function b(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",msTransform:"-ms-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}return{has3d:b(),transformProperty:a()}}).service("computeCarouselSlideStyle",function(a){return function(b,c,d){var e,f=100*b+c,g=(100-Math.abs(f))/100;if("slide"==d)e={left:f+"%"};else if("fadeAndSlide"==d){var h=0;Math.abs(f)<100&&(h=g),e={left:f+"%",opacity:h}}else if("hexagon"==d){var i=100,j=0,k=60*(g-1);return i=-100*b>c?100:0,j=-100*b>c?k:-k,e={left:f+"%","transform-origin":i+"% 50%"},e[a.transformProperty]="rotateY("+j+"deg)",e}return e}}).service("createStyleString",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){b.push(c+":"+a)}),b.join(";")}}).directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$rootScope","computeCarouselSlideStyle","createStyleString",function(a,b,c,d,e,f,g,h){{var i=0,j=.05;b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame}return{restrict:"A",scope:!0,compile:function(b,e){var f,k,l=b[0].querySelector("li").attributes,m=!1,n=!1;return["ng-repeat","data-ng-repeat","ng:repeat","x-ng-repeat"].every(function(a){var b=l[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(f=c[1],k=c[2],f)return angular.isDefined(e.rnCarouselBuffered)&&(n=!0,b.value=f+" in "+k+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),m=!0,!1}return!0}),function(b,e,f){function l(a){D=!0,s({x:a.clientX,y:a.clientY},a)}function m(a){var c,d;angular.forEach(e[0].querySelectorAll("li"),function(e,f){d=100*b.carouselBufferIndex+a,c=h(g(f,d,A.transitionType)),e.setAttribute("style",c)})}function o(a,c){if(c=c||{},c.animate===!1)return y=!1,C=-100*a,b.carouselIndex=a,m(C),void 0;y=!0;var d=new Tweenable;d.tween({from:{x:C},to:{x:-100*a},duration:A.transitionDuration,easing:A.transitionEasing,step:function(a){m(a.x)},finish:function(){b.$apply(function(){y=!1,b.carouselIndex=a,C=-100*a,t()})}})}function p(){return e[0].getBoundingClientRect().width}function q(a){return c.bind("mouseup",l),E=p(),F=e[0].querySelector("li").getBoundingClientRect().left,u=!0,v=a.x,!1}function r(a){var b,c;if(u&&(b=a.x,c=v-b,c>2||-2>c)){D=!0;var d=C+100*-c/E;m(d)}return!1}function s(a,d){if(!d||D)if(c.unbind("mouseup",l),u=!1,D=!1,w=v-a.x,C+=100*-w/E,A.isSequential){var e=j*E,f=-w,g=-Math[f>=0?"ceil":"floor"](f/E),h=Math.abs(f)>e;x&&g+b.carouselIndex>=x.length&&(g=x.length-1-b.carouselIndex),g+b.carouselIndex<0&&(g=-b.carouselIndex);var i=h?g:0;w=b.carouselIndex+i,o(w)}else b.$apply(function(){b.carouselIndex=parseInt(-C/100,10),t()})}function t(){var a=0,c=(b.carouselBufferSize-1)/2;if(n){a=b.carouselIndex<=c?0:x&&x.length<b.carouselBufferSize?0:x&&b.carouselIndex>x.length-b.carouselBufferSize?x.length-b.carouselBufferSize:b.carouselIndex-c;{b.carouselBufferIndex-a}b.carouselBufferIndex=a}}i++;var u,v,w,x,y,z={transitionType:f.rnCarouselTransition||"slide",transitionEasing:"easeTo",transitionDuration:300,isSequential:!0,bufferSize:5},A=angular.extend({},z),B=!1,C=0,D=!1,E=null,F=null;e.addClass("rn-carousel"),a.bind(e,{start:q,move:r,end:s,cancel:function(a){s({},a)}});var G=!0;if(b.carouselIndex=0,f.rnCarouselIndex){var H=function(a){I.assign(b.$parent,a)},I=d(f.rnCarouselIndex);angular.isFunction(I.assign)?(b.$watch("carouselIndex",function(a){y||H(a)}),b.$parent.$watch(I,function(a){void 0!==a&&null!==a&&(console.log("watch2",y,G),x&&a>=x.length?(a=x.length-1,H(a)):x&&0>a&&(a=0,H(a)),y||o(a,{animate:!G}),G=!1)}),B=!0):isNaN(f.rnCarouselIndex)||o(parseInt(f.rnCarouselIndex,10),{animate:!1})}b.$watchCollection(k,function(a){x=a,o(b.carouselIndex)}),b.$on("$destroy",function(){c.unbind("mouseup",l)}),b.carouselBufferIndex=0,b.carouselBufferSize=A.bufferSize}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();