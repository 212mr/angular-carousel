/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.5 - 2014-10-13
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselAutoSlide",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e=Math.round(1e3*parseFloat(d.rnCarouselAutoSlide)),f=increment=!1,g=c.children().length;b.carouselExposedIndex||(b.carouselExposedIndex=0),stopAutoplay=function(){angular.isDefined(f)&&a.cancel(f),f=void 0},increment=function(){b.carouselExposedIndex=b.carouselExposedIndex<g-1?b.carouselExposedIndex+1:0},restartTimer=function(){stopAutoplay(),f=a(increment,e)},b.$watch("carouselIndex",function(){restartTimer()}),restartTimer(),d.rnCarouselPauseOnHover&&"false"!=d.rnCarouselPauseOnHover&&(c.on("mouseenter",stopAutoplay),c.on("mouseleave",restartTimer)),b.$on("$destroy",function(){stopAutoplay(),c.off("mouseenter",stopAutoplay),c.off("mouseleave",restartTimer)})}}}]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index>0&&a.index--},a.next=function(){a.index<a.items.length-1&&a.index++}},templateUrl:"carousel-controls.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-controls.html",'<div class="rn-carousel-controls">\n  <span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span>\n  <span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span>\n</div>')}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{slides:"=",index:"=rnCarouselIndex"},templateUrl:"carousel-indicators.html",link:function(a,b,c,d){console.log("carouselCtrl",d)}}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-indicators.html",'<div>\n <span ng-repeat="slide in currentSlides" ng-click="$parent.carouselIndex=$index" ng-class="{active: $index==$parent.carouselIndex}"></span>\n</div>')}]),function(){"use strict";angular.module("angular-carousel").service("DeviceCapabilities",function(){function a(){var a="transform";return["webkit","moz","o","ms"].every(function(b){var c="-"+b+"-transform";return"undefined"!=typeof document.body.style[c]?(a=c,!1):!0}),a}function b(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",msTransform:"-ms-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}return{has3d:b(),transformProperty:a()}}).service("computeCarouselSlideStyle",function(a){return function(b,c,d){var e,f={display:"inline-block"},g=100*b+c,h=a.has3d?"translate3d("+g+"%, 0, 0)":"translate3d("+g+"%, 0)",i=(100-Math.abs(g))/100;if("slide"==d)f[a.transformProperty]=h;else if("fadeAndSlide"==d)f[a.transformProperty]=h,e=0,Math.abs(g)<100&&(e=.3+.7*i),f.opacity=e;else if("hexagon"==d){var j=100,k=0,l=60*(i-1);j=-100*b>c?100:0,k=-100*b>c?l:-l,f[a.transformProperty]=h+" rotateY("+k+"deg)",f["transform-origin"]=j+"% 50%"}else if("zoom"==d){f[a.transformProperty]=h;var m=1;Math.abs(g)<100&&(m=1+2*(1-i)),f[a.transformProperty]+=" scale("+m+")",f["transform-origin"]="50% 50%",e=0,Math.abs(g)<100&&(e=.3+.7*i),f.opacity=e}return f}}).service("createStyleString",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){b.push(c+":"+a)}),b.join(";")}}).directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$timeout","$interval","computeCarouselSlideStyle","createStyleString",function(a,b,c,d,e,f,g,h,i){{var j=0,k=.05;b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame}return{restrict:"A",scope:!0,compile:function(e,l){var m,n,o=e[0].querySelector("li").attributes,p=!1,q=!1;return["ng-repeat","data-ng-repeat","ng:repeat","x-ng-repeat"].every(function(a){var b=o[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(m=c[1],n=c[2],m)return angular.isDefined(l.rnCarouselBuffered)&&(q=!0,b.value=m+" in "+n+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),p=!0,!1}return!0}),function(e,l,m){function o(){return l[0].querySelectorAll("li")}function r(a){L=!0,z({x:a.clientX,y:a.clientY},a)}function s(a){var b,c;c=100*e.carouselBufferIndex+a,angular.forEach(o(),function(a,d){b=i(h(d,c,I.transitionType)),a.getAttribute("style")!==b&&a.setAttribute("style",b)})}function t(a){var b=e.carouselIndex+1;b>F.length-1&&(b=0),u(b,a)}function u(a,b){if(void 0===a&&(a=e.carouselIndex),b=b||{},b.animate===!1)return G=!1,K=-100*a,e.carouselIndex=a,A(),void 0;G=!0;var c=new Tweenable;c.tween({from:{x:K},to:{x:-100*a},duration:I.transitionDuration,easing:I.transitionEasing,step:function(a){s(a.x)},finish:function(){e.$apply(function(){G=!1,e.carouselIndex=a,K=-100*a,A()})}})}function v(){return l[0].getBoundingClientRect().width}function w(){M=v()}function x(a){return c.bind("mouseup",r),w(),N=l[0].querySelector("li").getBoundingClientRect().left,C=!0,D=a.x,!1}function y(a){var b,c;if(C&&(b=a.x,c=D-b,c>2||-2>c)){L=!0;var d=K+100*-c/M;s(d)}return!1}function z(a,b){if(!b||L)if(c.unbind("mouseup",r),C=!1,L=!1,E=D-a.x,K+=100*-E/M,I.isSequential){var d=k*M,f=-E,g=-Math[f>=0?"ceil":"floor"](f/M),h=Math.abs(f)>d;F&&g+e.carouselIndex>=F.length&&(g=F.length-1-e.carouselIndex),g+e.carouselIndex<0&&(g=-e.carouselIndex);var i=h?g:0;E=e.carouselIndex+i,u(E)}else e.$apply(function(){e.carouselIndex=parseInt(-K/100,10),A()})}function A(){var a=0,b=(e.carouselBufferSize-1)/2;q?(e.carouselIndex<=b?a=0:F&&F.length<e.carouselBufferSize?a=0:F&&e.carouselIndex>F.length-e.carouselBufferSize?a=F.length-e.carouselBufferSize:(console.log("compute buffer"),a=e.carouselIndex-b),e.carouselBufferIndex=a,f(function(){s(K)},0,!1)):f(function(){s(K)},0,!1)}function B(){w(),u()}j++;var C,D,E,F,G,H={transitionType:m.rnCarouselTransition||"slide",transitionEasing:"easeTo",transitionDuration:300,isSequential:!0,bufferSize:5},I=angular.extend({},H),J=!1,K=0,L=!1,M=null,N=null;a.bind(l,{start:x,move:y,end:z,cancel:function(a){z({},a)}});var O=!0;e.carouselIndex=0,p||(F=[],angular.forEach(o(),function(a,b){F.push({id:b})}));var P;if(m.rnCarouselAutoSlide){var Q=parseInt(m.rnCarouselAutoSlide,10)||3;P=g(function(){t()},1e3*Q)}if(m.rnCarouselIndex){var R=function(a){S.assign(e.$parent,a)},S=d(m.rnCarouselIndex);angular.isFunction(S.assign)?(e.$watch("carouselIndex",function(a){G||R(a)}),e.$parent.$watch(S,function(a){void 0!==a&&null!==a&&(F&&a>=F.length?(a=F.length-1,R(a)):F&&0>a&&(a=0,R(a)),G||u(a,{animate:!O}),O=!1)}),J=!0):isNaN(m.rnCarouselIndex)||u(parseInt(m.rnCarouselIndex,10),{animate:!1})}else u(0,{animate:!O}),O=!1;p&&e.$watchCollection(n,function(a){F=a,u(e.carouselIndex)}),e.$on("$destroy",function(){c.unbind("mouseup",r)}),e.carouselBufferIndex=0,e.carouselBufferSize=I.bufferSize;var T=angular.element(b);T.bind("orientationchange",B),T.bind("resize",B),e.$on("$destroy",function(){c.unbind("mouseup",r),T.unbind("orientationchange",B),T.unbind("resize",B)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();